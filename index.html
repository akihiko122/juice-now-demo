<script>
    const origin = '3.1390,101.6869';

    function calculateDeliveryFee(destination) {
      const service = new google.maps.DistanceMatrixService();
      service.getDistanceMatrix({
        origins: [origin],
        destinations: [destination],
        travelMode: 'DRIVING',
        unitSystem: google.maps.UnitSystem.METRIC
      }, function (response, status) {
        if (status === 'OK') {
          const distanceValue = response.rows[0].elements[0].distance.value / 1000;

          let fee = 0;
          if (distanceValue > 30) fee = 30;
          else if (distanceValue > 20) fee = 25;
          else if (distanceValue > 15) fee = 20;
          else if (distanceValue > 10) fee = 15;
          else if (distanceValue > 5) fee = 10;
          else if (distanceValue > 0) fee = 5;

          document.getElementById('deliveryFee').textContent = fee.toFixed(2);
          document.getElementById('total').textContent = (189 + fee).toFixed(2);
        }
      });
    }

    function initAutocomplete() {
      const input = document.getElementById('address');
      const autocomplete = new google.maps.places.Autocomplete(input);
      autocomplete.addListener('place_changed', function () {
        const place = autocomplete.getPlace();
        if (place.geometry && place.geometry.location) {
          const destination = place.geometry.location.lat() + ',' + place.geometry.location.lng();
          calculateDeliveryFee(destination);
        }
      });
    }

    let currentSlide = 0;
    const slides = document.querySelectorAll('.carousel-slide');

    function showSlide(index) {
      slides.forEach((slide, i) => {
        slide.classList.remove('active');
        if (i === index) slide.classList.add('active');
      });
    }

    function nextSlide() {
      currentSlide = (currentSlide + 1) % slides.length;
      showSlide(currentSlide);
    }

    function prevSlide() {
      currentSlide = (currentSlide - 1 + slides.length) % slides.length;
      showSlide(currentSlide);
    }

    let startX = 0;
    const carousel = document.querySelector('.carousel-container');

    carousel.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
    });

    carousel.addEventListener('touchend', (e) => {
      const endX = e.changedTouches[0].clientX;
      if (startX - endX > 50) nextSlide();
      else if (endX - startX > 50) prevSlide();
    });

    setInterval(() => {
      nextSlide();
    }, 4000);

    document.getElementById('whatsappLink').addEventListener('click', function (e) {
      const name = document.getElementById('name').value.trim();
      const phone = document.getElementById('phone').value.trim();
      const address = document.getElementById('address').value.trim();
      const fee = document.getElementById('deliveryFee').textContent.trim();
      const total = document.getElementById('total').textContent.trim();

      if (!name || !phone || !address) {
        alert('Please fill in your name, phone, and address before confirming your order.');
        e.preventDefault();
        return;
      }

      const message = `Hi Juice Now! I want to order the 3-day juice cleanse. Hereâ€™s my info:%0AName: ${encodeURIComponent(name)}%0APhone: ${encodeURIComponent(phone)}%0AAddress: ${encodeURIComponent(address)}%0ADelivery Fee: RM ${fee}%0ATotal: RM ${total}`;
      this.href = `https://wa.me/60183648836?text=${message}`;
    });

    window.onload = initAutocomplete;
</script>
